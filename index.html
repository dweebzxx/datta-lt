<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>datta Ai</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        light: '#F4F3EE',
                        dark: '#1a202c',
                        panelLight: 'rgba(255, 255, 255, 0.9)',
                        panelDark: 'rgba(30, 41, 59, 0.9)',
                        tealbrand: '#005960',
                        orangebrand: '#CC5500'
                    }
                }
            }
        }
    </script>
    
    <!-- Core Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2/dist/echarts-wordcloud.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.4.2/chroma.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstat/1.9.6/jstat.min.js"></script>
    
    <!-- Custom Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #F4F3EE;
            --text-color: #2C2C2C;
            --panel-bg: rgba(255, 255, 255, 0.9);
            --border-color: rgba(0, 0, 0, 0.1);
        }
        
        html.dark {
            --bg-color: #1a202c;
            --text-color: #F4E3C1;
            --panel-bg: rgba(30, 41, 59, 0.9);
            --border-color: rgba(255, 255, 255, 0.1);
        }
        
        /* High Contrast in Dark Mode */
        html.dark body, html.dark h1, html.dark h2, html.dark h3, html.dark p, html.dark span, html.dark label, html.dark td, html.dark th {
            color: #F4F3EE !important;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(156, 163, 175, 0.5);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(156, 163, 175, 0.8);
        }

        .glass-panel {
            background: var(--panel-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            transition: background 0.3s ease, border-color 0.3s ease;
        }
        
        .chart-canvas {
            width: 100%;
            height: 100%;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            padding: 2rem;
            overflow-y: auto;
            height: 100%;
        }
        
        .mini-card {
            height: 200px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .mini-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Heatmap Table */
        .crosstab-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }
        .crosstab-table th, .crosstab-table td {
            border: 1px solid var(--border-color);
            padding: 0.5rem;
            text-align: center;
        }
        .crosstab-table th {
            font-weight: 600;
        }
        
        /* Transitions */
        .view-transition {
            transition: transform 0.4s cubic-bezier(0.2, 0, 0.2, 1), opacity 0.4s cubic-bezier(0.2, 0, 0.2, 1);
        }
        
        .view-hidden {
            transform: scale(0.95);
            opacity: 0;
            pointer-events: none;
            position: absolute;
            inset: 0;
        }
        
        .view-visible {
            transform: scale(1);
            opacity: 1;
            position: relative;
            height: 100%;
            width: 100%;
        }
        
        /* Button Styles */
        .btn-outline {
            border: 1px solid rgba(156, 163, 175, 0.5); /* gray-400 */
            transition: all 0.2s;
        }
        .btn-outline:hover {
            background-color: rgba(156, 163, 175, 0.1);
        }
        .btn-active {
            background-color: #EFF6FF !important; /* blue-50 */
            color: #1E40AF !important; /* blue-800 */
            border-color: #BFDBFE !important; /* blue-200 */
            font-weight: 700 !important;
        }
        html.dark .btn-active {
            background-color: #1E3A8A !important; /* blue-900 */
            color: #DBEAFE !important; /* blue-100 */
            border-color: #1E40AF !important; /* blue-800 */
        }
        
        /* Data Table */
        .sticky-table-container {
            overflow: auto;
            height: 100%;
        }
        .sticky-table {
            width: 100%;
            border-collapse: separate; 
            border-spacing: 0;
        }
        .sticky-table th {
            position: sticky;
            top: 0;
            background: var(--panel-bg);
            z-index: 10;
            border-bottom: 2px solid var(--border-color);
        }
        
        /* Print Styles */
        @media print {
            aside, header, #respondent-panel, #stats-container {
                display: none !important;
            }
            .dashboard-grid {
                display: block !important;
                overflow: visible !important;
            }
            .mini-card {
                break-inside: avoid;
                border: 1px solid #ccc;
                margin-bottom: 20px;
                page-break-inside: avoid;
            }
            body {
                background: white !important;
                color: black !important;
                height: auto !important;
                overflow: visible !important;
            }
        }
    </style>
</head>
<body>
    <div class="flex h-screen w-screen overflow-hidden">
        
        <!-- Left Sidebar: Controls (Visible only in Inspector Mode) -->
        <aside id="inspector-sidebar" class="hidden w-64 flex-shrink-0 glass-panel border-r flex flex-col z-20 h-full overflow-y-auto transition-transform">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <button id="btn-back-dashboard" class="text-xs flex items-center hover:text-blue-500 font-medium">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                    Back
                </button>
                <h2 class="text-sm font-bold">Inspector</h2>
            </div>
            
            <div class="p-3 space-y-4 flex-1 text-sm">
                <!-- Data View Toggle -->
                <section>
                    <div class="flex items-center justify-between gap-2">
                        <div class="flex flex-1 p-1 bg-gray-200 dark:bg-gray-700 rounded-lg">
                            <button id="view-mode-viz" class="flex-1 py-1.5 text-xs font-medium rounded-md bg-white dark:bg-gray-600 shadow-sm transition-all">Visualizer</button>
                            <button id="view-mode-data" class="flex-1 py-1.5 text-xs font-medium rounded-md hover:bg-gray-50 dark:hover:bg-gray-500 transition-all text-gray-500 dark:text-gray-300">Data Table</button>
                        </div>
                        <button id="btn-reset-visualizer" class="px-2 py-1 text-[11px] border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-800 transition">Reset</button>
                    </div>
                </section>

                <!-- Mapping -->
                <section id="config-section" class="collapsible-section">
                    <button class="section-toggle flex justify-between items-center w-full text-xs font-semibold uppercase tracking-wider mb-2 opacity-70 hover:opacity-100" data-target="config-section-content" aria-expanded="true">
                        <span>Configuration</span>
                        <svg class="w-3 h-3 transition-transform transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>

                    <div id="config-section-content" class="space-y-3 collapsible-content">
                        <div>
                            <label class="block text-xs mb-1 font-medium">X-Axis / Variable 1</label>
                            <select id="x-axis-select" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="">Select...</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-xs mb-1 font-medium">Y-Axis / Variable 2 (Opt)</label>
                            <select id="y-axis-select" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="">Count Occurrences</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-xs mb-1 font-medium">Compare up to 6 Variables</label>
                            <select id="multi-axis-select" multiple size="6" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs focus:ring-2 focus:ring-blue-500 outline-none min-h-[120px]">
                                <option value="">None</option>
                            </select>
                            <p class="mt-1 text-[10px] text-gray-500 dark:text-gray-400">Hold Ctrl/Cmd to pick multiple variables that share the same response options.</p>
                        </div>

                        <div>
                            <label class="block text-xs mb-1 font-medium">Group By / Split</label>
                            <select id="group-by-select" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="">None</option>
                            </select>
                        </div>

                        <div class="space-y-2 pt-2">
                            <div class="flex items-center">
                                <input id="split-values" type="checkbox" class="w-3 h-3 rounded text-blue-600 focus:ring-blue-500">
                                <label for="split-values" class="ml-2 text-xs">Split Comma-Separated</label>
                            </div>
                            <div class="flex items-center">
                                <input id="strict-mode" type="checkbox" class="w-3 h-3 rounded text-blue-600 focus:ring-blue-500">
                                <label for="strict-mode" class="ml-2 text-xs">Strict Multi-Select</label>
                            </div>
                            <div class="flex items-center">
                                <input id="hide-self-comparison" type="checkbox" checked class="w-3 h-3 rounded text-blue-600 focus:ring-blue-500">
                                <label for="hide-self-comparison" class="ml-2 text-xs">Hide Self-Comparison</label>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Labels & Text -->
                <section id="labels-section" class="collapsible-section">
                    <button class="section-toggle flex justify-between items-center w-full text-xs font-semibold uppercase tracking-wider mb-2 opacity-70 hover:opacity-100" data-target="labels-section-content" aria-expanded="true">
                        <span>Labels & Text</span>
                        <svg class="w-3 h-3 transition-transform transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="labels-section-content" class="space-y-2 collapsible-content">
                        <input id="custom-title" type="text" placeholder="Chart Title" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs outline-none">
                        <input id="custom-subtitle" type="text" placeholder="Sub-title" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs outline-none">
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block text-[11px] font-semibold mb-1">Title Size</label>
                                <input id="title-font-size" type="number" value="18" min="8" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs outline-none">
                            </div>
                            <div>
                                <label class="block text-[11px] font-semibold mb-1">Subtitle Size</label>
                                <input id="subtitle-font-size" type="number" value="14" min="8" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs outline-none">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block text-[11px] font-semibold mb-1">Title Horizontal Position</label>
                                <input id="title-left" type="text" value="center" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs outline-none" placeholder="center or 20%">
                            </div>
                            <div>
                                <label class="block text-[11px] font-semibold mb-1">Title Vertical Offset (px)</label>
                                <input id="title-offset-y" type="number" value="0" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs outline-none">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <input id="custom-xlabel" type="text" placeholder="X-Axis Label" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs outline-none">
                            <input id="custom-ylabel" type="text" placeholder="Y-Axis Label" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs outline-none">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block text-[11px] font-semibold mb-1">Axis Title Size</label>
                                <input id="axis-title-font-size" type="number" value="14" min="8" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs outline-none">
                            </div>
                            <div>
                                <label class="block text-[11px] font-semibold mb-1">Axis Label Size</label>
                                <input id="axis-label-font-size" type="number" value="13" min="8" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs outline-none">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block text-[11px] font-semibold mb-1">Axis Title Gap (px)</label>
                                <input id="axis-title-gap" type="number" value="30" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs outline-none">
                            </div>
                            <div>
                                <label class="block text-[11px] font-semibold mb-1">Axis Label Margin (px)</label>
                                <input id="axis-label-margin" type="number" value="8" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs outline-none">
                            </div>
                        </div>
                        <div>
                            <label class="block text-[11px] font-semibold mb-1">Pie/Donut Label Size</label>
                            <input id="pie-label-font-size" type="number" value="13" min="8" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs outline-none">
                        </div>
                    </div>
                </section>

                <!-- Chart Type -->
                <section id="viz-type-section" class="collapsible-section">
                    <button class="section-toggle flex justify-between items-center w-full text-xs font-semibold uppercase tracking-wider mb-2 opacity-70 hover:opacity-100" data-target="viz-type-section-content" aria-expanded="true">
                        <span>Visualization</span>
                        <svg class="w-3 h-3 transition-transform transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="viz-type-section-content" class="grid grid-cols-2 gap-2 max-h-60 overflow-y-auto pr-1 custom-scrollbar collapsible-content">
                        <button class="chart-type-btn btn-outline btn-active px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="bar">Vertical Bar</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="bar-horizontal">Horizontal Bar</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="grouped-bar">Grouped Bar</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="side-by-side-bar">Side-by-Side Bar</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="stacked-column">Stacked Bar</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="100-stacked-column">100% Stacked</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="horizontal-stacked">Horizontal Stacked</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="horizontal-100-stacked">Horizontal 100% Stacked</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="diverging-bar">Diverging Bar</button>
                        
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="pie">Pie Chart</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="donut">Donut Chart</button>
                        
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="line">Line Chart</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="area">Area Chart</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="slope">Slope Graph</button>

                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="scatter">Scatter Plot</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="scatter-jitter">Scatter + Jitter</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="histogram">Histogram</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="boxplot">Box Plot</button>

                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="heatmap">Heatmap</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="demographic-heatmap">Demographic Ã— Response Heatmap</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="correlation-heatmap">Correlation Heatmap</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="radar">Radar Chart</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="wordCloud">Word Cloud</button>
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium text-left truncate" data-type="sankey">Sankey</button>
                        
                        <button class="chart-type-btn btn-outline px-2 py-1.5 rounded text-xs font-medium col-span-2 text-center" data-type="crosstab">Crosstab Table</button>
                    </div>
                </section>

                <!-- Appearance (Simplified) -->
                <section id="theme-section" class="collapsible-section">
                     <button class="section-toggle flex justify-between items-center w-full text-xs font-semibold uppercase tracking-wider mb-2 opacity-70 hover:opacity-100" data-target="theme-section-content" aria-expanded="true">
                        <span>Theme</span>
                        <svg class="w-3 h-3 transition-transform transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                     </button>
                     <div id="theme-section-content" class="collapsible-content">
                         <div class="mb-2 space-y-1">
                            <label class="block text-[11px] font-semibold">Color Theme (10 curated palettes)</label>
                            <select id="color-theme-select" class="w-full bg-transparent border border-gray-300 dark:border-gray-600 rounded p-1.5 text-xs focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="aurora">Aurora (Default)</option>
                                <option value="canyon">Canyon</option>
                                <option value="seashore">Seashore</option>
                                <option value="ltikes">LTikes</option>
                                <option value="moss">Moss</option>
                                <option value="bloom">Bloom</option>
                                <option value="mono">Monotone</option>
                                <option value="jewel">Jewel</option>
                                <option value="pastelpunch">Pastel Punch</option>
                                <option value="midnight">Midnight</option>
                            </select>
                         </div>
                         <div class="flex justify-between items-center mb-2">
                            <span class="text-xs">Custom Palette</span>
                            <button id="btn-shuffle-colors" class="text-[10px] text-blue-500 hover:text-blue-700">Shuffle</button>
                         </div>
                         <div class="grid grid-cols-5 gap-1 mb-2" id="color-inputs">
                                <input type="text" placeholder="#" class="color-input w-full p-1 text-[10px] border rounded text-center" aria-label="Color 1">
                                <input type="text" placeholder="#" class="color-input w-full p-1 text-[10px] border rounded text-center">
                                <input type="text" placeholder="#" class="color-input w-full p-1 text-[10px] border rounded text-center">
                                <input type="text" placeholder="#" class="color-input w-full p-1 text-[10px] border rounded text-center">
                                <input type="text" placeholder="#" class="color-input w-full p-1 text-[10px] border rounded text-center">
                                <input type="text" placeholder="#" class="color-input w-full p-1 text-[10px] border rounded text-center">
                                <input type="text" placeholder="#" class="color-input w-full p-1 text-[10px] border rounded text-center">
                                <input type="text" placeholder="#" class="color-input w-full p-1 text-[10px] border rounded text-center">
                                <input type="text" placeholder="#" class="color-input w-full p-1 text-[10px] border rounded text-center">
                                <input type="text" placeholder="#" class="color-input w-full p-1 text-[10px] border rounded text-center" aria-label="Color 10">
                         </div>
                         <div class="flex items-center justify-between text-[11px] bg-gray-50 dark:bg-gray-800 border border-dashed border-gray-200 dark:border-gray-700 rounded p-2">
                            <span class="font-semibold">Quick Demos</span>
                            <div class="space-x-1">
                                <button id="btn-demo-bar" class="px-2 py-1 rounded border text-[11px]">Sample Bar</button>
                                <button id="btn-demo-heatmap" class="px-2 py-1 rounded border text-[11px]">Sample Heatmap</button>
                            </div>
                         </div>
                     </div>
                </section>
            </div>
        </aside>
        
        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col h-full overflow-hidden relative">
            
            <!-- Global Header -->
            <header class="h-12 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between px-4 glass-panel z-30 flex-shrink-0">
                <div class="flex items-center space-x-4">
                     <!-- Branding -->
                     <h1 class="text-lg font-bold tracking-tight">
                         <span>datta</span> <span class="text-tealbrand">A</span><span class="text-orangebrand">i</span>
                     </h1>
                     
                     <!-- Data Source Summary (Compact) -->
                     <div id="data-summary" class="hidden text-xs px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded flex items-center space-x-2">
                         <span id="file-name-display" class="font-semibold">No Data</span>
                         <span class="text-gray-400">|</span>
                         <span id="row-count-display">0 rows</span>
                     </div>
                </div>
                
                <div class="flex items-center space-x-3">
                     <!-- Upload Trigger -->
                     <label for="file-upload" class="cursor-pointer text-xs flex items-center hover:text-blue-500 font-medium transition-colors">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                        Upload Data
                     </label>
                     <input id="file-upload" type="file" class="hidden" accept=".csv,.json" />
                     
                     <!-- Codebook Trigger -->
                     <button id="btn-codebook-trigger" class="text-xs flex items-center hover:text-blue-500 font-medium transition-colors">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                        Codebook
                     </button>

                     <!-- How to Use -->
                     <button id="btn-how-to-use" class="text-xs flex items-center hover:text-blue-500 font-medium transition-colors">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Help
                     </button>
                     
                     <!-- Print Report (Dashboard Only) -->
                     <button id="btn-print-report" class="hidden text-xs flex items-center hover:text-blue-500 font-medium transition-colors">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                        Print Report
                     </button>

                     <!-- Dark Mode Toggle -->
                     <button id="dark-mode-toggle" class="p-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition">
                         <!-- Sun -->
                         <svg class="w-4 h-4 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                         <!-- Moon -->
                         <svg class="w-4 h-4 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                     </button>
                </div>
            </header>

            <!-- Views Container with Relative Positioning for Transitions -->
            <div class="flex-1 relative overflow-hidden">
                
                <!-- Dashboard View -->
                <div id="dashboard-view" class="view-transition view-visible">
                    <div id="dashboard-grid" class="dashboard-grid">
                         <!-- Mini Cards Generated Here -->
                         <div class="col-span-full flex items-center justify-center h-full opacity-30 flex-col">
                             <div class="text-6xl font-bold tracking-tight mb-2">
                                 <span>datta</span> <span class="text-tealbrand">A</span><span class="text-orangebrand">i</span>
                             </div>
                             <p class="text-lg">Upload a CSV or JSON file to begin.</p>
                         </div>
                    </div>
                </div>

                <!-- Inspector View -->
                <div id="inspector-view" class="view-transition view-hidden flex h-full">
                    
                    <!-- Visualizer Mode -->
                    <div id="viz-container" class="flex-1 flex flex-col h-full relative">
                        <!-- Chart Area -->
                        <div class="flex-1 p-6 relative flex flex-col min-h-0">
                            <div class="flex justify-between items-center mb-2">
                                <h2 id="chart-title" class="text-lg font-extrabold truncate max-w-xl"></h2>
                                <button id="btn-download-chart" class="text-xs flex items-center text-gray-500 hover:text-blue-500 transition-colors">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                                    Export Image
                                </button>
                            </div>
                            
                            <div id="main-chart" class="w-full flex-1 min-h-0"></div>
                            
                            <!-- Notes Area -->
                            <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                                <label class="block text-xs font-semibold mb-1 text-gray-500">Analyst Notes</label>
                                <textarea id="chart-notes" class="w-full h-16 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded p-2 text-xs focus:ring-2 focus:ring-blue-500 outline-none resize-none" placeholder="Type observations here... (Saved automatically)"></textarea>
                            </div>

                            <!-- Bottom Panel: Respondent Inspector (Slide Up) -->
                            <div id="respondent-panel" class="absolute bottom-0 left-0 right-0 h-48 glass-panel border-t transform translate-y-full transition-transform duration-300 z-20 flex flex-col mx-4 rounded-t-lg shadow-lg">
                                <div class="flex items-center justify-between p-2 border-b border-gray-200 dark:border-gray-700 bg-white/50 dark:bg-black/20">
                                    <h3 class="font-semibold text-xs">Respondent Inspector <span id="inspector-count" class="ml-2 bg-blue-100 text-blue-800 text-[10px] px-1.5 py-0.5 rounded-full">0</span></h3>
                                    <button id="close-panel" class="text-gray-500 hover:text-gray-800 dark:hover:text-gray-200">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                    </button>
                                </div>
                                <div class="flex-1 overflow-y-auto p-2">
                                    <div id="respondent-list" class="flex flex-wrap gap-1"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Table Mode (Initially Hidden) -->
                    <div id="data-table-container" class="hidden flex-1 p-4 h-full overflow-hidden">
                        <div class="sticky-table-container glass-panel rounded-lg border border-gray-200 dark:border-gray-700">
                            <table id="raw-data-table" class="sticky-table text-xs">
                                <thead id="raw-data-head" class="text-left bg-gray-50 dark:bg-gray-800"></thead>
                                <tbody id="raw-data-body"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Right Sidebar: Stats & Filters -->
                    <aside class="w-72 flex-shrink-0 glass-panel border-l flex flex-col z-20 h-full overflow-y-auto">
                        <!-- Statistical Analysis Panel -->
                        <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                            <h2 class="font-bold text-sm mb-2 flex items-center">
                                <svg class="w-4 h-4 mr-1 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                                Analysis
                            </h2>
                            <div id="stats-container" class="space-y-2 text-xs">
                                <p class="text-gray-400 italic">Select a chart to see statistics.</p>
                            </div>
                        </div>

                        <!-- Filters -->
                        <div class="p-4">
                            <div class="flex justify-between items-end mb-2">
                                <h2 class="font-bold text-sm">Filters</h2>
                                <span id="filter-count-display" class="text-[10px] text-gray-500"></span>
                            </div>
                            <div id="filters-container" class="space-y-3">
                                <button id="btn-add-filter" class="w-full py-1.5 border border-dashed border-gray-300 dark:border-gray-600 rounded text-xs text-gray-500 hover:bg-gray-50 dark:hover:bg-gray-800 transition">+ Add Filter</button>
                            </div>
                        </div>
                    </aside>
                </div>
            </div>

        </div>
    </div>

    <!-- Modals -->
    <!-- Codebook / Map Modal -->
     <div id="map-modal-overlay" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-900 rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] flex flex-col border border-gray-200 dark:border-gray-700">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="font-bold text-lg">Codebook Management</h3>
                <button id="close-map-modal" class="text-gray-500 hover:text-black dark:hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <!-- Codebook Actions Toolbar -->
            <div class="p-2 bg-gray-50 dark:bg-gray-800 flex space-x-2 border-b border-gray-200 dark:border-gray-700">
                <label for="codebook-csv-upload" class="px-3 py-1.5 bg-blue-600 text-white rounded text-xs cursor-pointer hover:bg-blue-700 transition">Import CSV</label>
                <input type="file" id="codebook-csv-upload" class="hidden" accept=".csv" />
                <button id="btn-download-codebook" class="px-3 py-1.5 bg-gray-200 dark:bg-gray-700 rounded text-xs hover:bg-gray-300 transition">Download Template</button>
            </div>

            <div class="p-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50">
                <label class="block text-sm font-medium mb-1">Edit Variable Mapping</label>
                <select id="map-column-select" class="w-full border p-2 rounded text-sm bg-white dark:bg-gray-800 dark:border-gray-600">
                    <option value="">Select a column...</option>
                </select>
            </div>
            <div class="p-0 overflow-y-auto flex-1">
                <table class="w-full text-sm text-left">
                    <thead class="text-xs text-gray-700 dark:text-gray-300 uppercase bg-gray-50 dark:bg-gray-800 sticky top-0">
                        <tr>
                            <th scope="col" class="px-6 py-3">Original Value</th>
                            <th scope="col" class="px-6 py-3">Mapped Label</th>
                        </tr>
                    </thead>
                    <tbody id="map-table-body" class="divide-y divide-gray-200 dark:divide-gray-700">
                        <!-- Rows -->
                    </tbody>
                </table>
            </div>
            <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-2 bg-white dark:bg-gray-900 rounded-b-lg">
                <button id="save-map" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">Save Changes</button>
            </div>
        </div>
    </div>
    
    <!-- Respondent Detail Modal -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-900 rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col border border-gray-200 dark:border-gray-700">
             <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="font-bold text-lg">Respondent Details</h3>
                <button id="close-modal" class="text-gray-500 hover:text-black dark:hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="p-6 overflow-y-auto" id="modal-content"></div>
        </div>
    </div>

    <!-- How to Use Modal -->
    <div id="help-modal-overlay" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-900 rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col border border-gray-200 dark:border-gray-700">
             <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="font-bold text-lg">How to Use</h3>
                <button id="close-help-modal" class="text-gray-500 hover:text-black dark:hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="p-6 overflow-y-auto text-sm space-y-4">
                <section>
                    <h4 class="font-bold mb-1">1. Upload Data</h4>
                    <p>Click "Upload Data" and select a CSV or JSON file. The first row should contain headers. The app will automatically generate a dashboard of mini-charts.</p>
                </section>
                <section>
                    <h4 class="font-bold mb-1">2. Explore & Analyze</h4>
                    <p>Click on any mini-chart or use the "Inspector" button to dive deeper. In Inspector mode, you can change chart types, filter data, and apply cross-tabulations.</p>
                </section>
                <section>
                    <h4 class="font-bold mb-1">3. Multi-Select Questions</h4>
                    <p>If a column contains multiple answers (e.g., "Apple, Banana"), enable "Split Comma-Separated" in the Configuration panel to count them individually.</p>
                </section>
                <section>
                    <h4 class="font-bold mb-1">4. Codebook & Mapping</h4>
                    <p>Use the "Codebook" button to map raw values (e.g., "1") to labels (e.g., "Very Satisfied"). You can upload a CSV codebook in the format: <code>Variable, Value, Label, Question</code>.</p>
                </section>
            </div>
        </div>
    </div>

    <!-- Hidden input for codebook JSON (legacy support) -->
    <input type="file" id="codebook-upload" class="hidden" accept=".json">

    <script src="main.js"></script>
</body>
</html>